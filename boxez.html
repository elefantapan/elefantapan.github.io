<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Crowey boxez</title>
<style>
:root{
  --bg:#1e1e2f;
  --tile:#2a2a40;
  --accent:#00b894;
  --text:#ffffff;
  --miss:#e74c3c;
}
*{box-sizing:border-box}
body{
  background:var(--bg);
  color:var(--text);
  font-family:system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  margin:0; padding:18px; display:flex; flex-direction:column; align-items:center; gap:12px;
}
h1{margin:4px 0}
.badge{background:var(--tile);padding:8px 12px;border-radius:8px;border:1px solid rgba(255,255,255,0.04)}
nav{display:flex;gap:8px;flex-wrap:wrap;justify-content:center;margin:8px 0}
nav button{background:var(--tile);border:none;color:var(--text);padding:8px 12px;border-radius:6px;cursor:pointer}
nav button:hover{box-shadow:0 0 14px rgba(0,255,200,0.06)}
.container{width:100%;max-width:1200px}
.tabs{display:flex;gap:8px;justify-content:center;margin-bottom:12px}
.tab{display:none}
.tab.active{display:block}

/* Boxes grid */
#boxesGrid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px}
.boxCard{background:var(--tile);border-radius:12px;padding:12px;display:flex;flex-direction:column;gap:8px;min-height:150px;align-items:center;justify-content:space-between;border:1px solid rgba(255,255,255,0.03)}
.boxCard h3{margin:0;font-size:1.05rem}
.boxPrice{opacity:.95}

/* Buttons */
.btn{padding:8px 12px;border-radius:8px;background:var(--bg);color:var(--text);border:none;cursor:pointer;box-shadow:0 0 6px rgba(0,255,200,0.06)}
.btn:hover{box-shadow:0 0 16px rgba(0,255,200,0.12)}

/* Case popup */
.case-popup, .win-popup{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0.86);z-index:3000}
.case-window{width:min(96vw,1100px);background:var(--tile);border-radius:12px;padding:14px;border:2px solid var(--accent);box-shadow:0 18px 60px rgba(0,0,0,0.6);position:relative}
.stripWrap{position:relative;height:150px;overflow:hidden;border-radius:10px;margin-top:12px}
.centerPointer{position:absolute;top:0;bottom:0;left:50%;transform:translateX(-50%);width:6px;background:linear-gradient(180deg,transparent,#ff3b3b,transparent);z-index:5000;pointer-events:none;box-shadow:0 0 12px rgba(255,0,0,0.25)}
.case-strip{display:flex;align-items:center;height:100%;transform:translateX(0);will-change:transform}
.case-item{min-width:160px;height:100px;margin:8px;border-radius:10px;background:#202038;border:2px solid rgba(255,255,255,0.03);display:flex;flex-direction:column;align-items:center;justify-content:center;gap:6px;padding:8px;color:var(--text);flex-shrink:0}
.case-item.small{min-width:120px;font-size:.90rem;padding:6px}
.iname{font-weight:700}
.ival{opacity:.9;font-size:.9rem}

/* rarity */
.r-common{border-color:#4a5568}
.r-uncommon{border-color:#2196f3}
.r-epic{border-color:#9c27b0}
.r-legendary{border-color:#ff9800}
.r-diamond{border-color:#00ffff}
.r-rainbow {
  border: 4px solid; /* width of the border */
  border-image: linear-gradient(45deg, red, orange, yellow, green, blue, indigo, violet) 1;
  padding: 8px;
  color: white;
  font-weight: bold;
}



/* Win popup */
.win-box{background:var(--tile);border-radius:10px;padding:14px;border:2px solid var(--accent);width:min(92vw,520px);box-shadow:0 12px 40px rgba(0,0,0,0.6)}
.win-meta{opacity:.9;margin-top:6px}

/* Inventory */
#invGrid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:12px;margin-top:12px}
.invCard{background:var(--tile);padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.03);text-align:left}
.invMeta{display:flex;justify-content:space-between;align-items:center;gap:10px;margin-top:8px}

/* Redeem area */
.redeemArea{display:flex;gap:8px;flex-wrap:wrap;justify-content:center;margin-top:10px}
.redeemMsg{margin-top:8px;min-height:20px;opacity:.95}

/* small screens */
@media (max-width:520px){
  .case-item{min-width:120px}
  .case-window{padding:10px}
}
</style>
</head>
<body>
  <h1>üéÅ Crowey boxez</h1>

  <div style="display:flex;gap:10px;align-items:center;">
    <div class="badge">Balance: $<span id="balance">10.00</span></div>
    <button class="btn" id="addDollar">Add $1</button>
  </div>

  <nav>
    <button id="btnHome">Boxes</button>
    <button id="btnInv">Inventory</button>
    <button id="btnRedeem">Redeem</button>
  </nav>

  <div class="container">
    <!-- Boxes -->
    <section id="homeTab" class="tab active">
      <div id="boxesGrid" aria-live="polite"></div>
    </section>

    <!-- Inventory -->
    <section id="invTab" class="tab">
      <h2>Your Items</h2>
      <div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:10px">
        <button class="btn filterBtn" data-filter="all">All</button>
        <button class="btn filterBtn" data-filter="common">Common</button>
        <button class="btn filterBtn" data-filter="uncommon">Uncommon</button>
        <button class="btn filterBtn" data-filter="epic">Epic</button>
        <button class="btn filterBtn" data-filter="legendary">Legendary</button>
      </div>
      <div id="invGrid"></div>
    </section>

    <!-- Redeem -->
    <section id="redeemTab" class="tab">
      <h2>Redeem Codes</h2>
      <div class="redeemArea">
        <input id="redeemInput" placeholder="Enter code (any case)" />
        <button class="btn" id="redeemBtn">Redeem</button>
      </div>
      <div id="redeemMsg" class="redeemMsg"></div>
    </section>
  </div>

  <!-- Case popup -->
  <div class="case-popup" id="casePopup" aria-hidden="true">
    <div class="case-window" role="dialog" aria-modal="true">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div style="font-weight:700">Opening case‚Ä¶</div>
        <div style="opacity:.85;font-size:.9rem">Good luck!</div>
      </div>
      <div class="stripWrap">
        <div class="centerPointer" id="centerPointer"></div>
        <div class="case-strip" id="caseStrip" aria-live="polite"></div>
      </div>
    </div>
  </div>

  <!-- Win popup -->
  <div class="win-popup" id="winPopup" aria-hidden="true">
    <div class="win-box">
      <h3 id="winTitle">You got:</h3>
      <div id="winMeta" class="win-meta"></div>
      <div style="display:flex;gap:8px;justify-content:center;margin-top:12px">
        <button class="btn" id="keepBtn">Keep</button>
        <button class="btn" id="sellBtn">Sell</button>
      </div>
    </div>
  </div>

<script>
/* ---------------- State ---------------- */
let balance = 10.00;
let inventory = [];
let currentDrop = null;
let currentBoxIndex = null;
let riggedDropsLeft = 0;


/* Redeem codes (normalized keys) */
const redeemCodes = {
  "money": 8,
  "freemoney": 10,
  "2025": 3.65,
  "soon2026": 9.62,
  "gimmiedemmoney": 95.21,
  "m0n3y": 5.25,
  
  // New codes
  "diamondboost": 1000,
  "alberto": 110000000,
  "bomba": 1000000000,
  "jackpot": 750,
  "skillissue": 30000,
  "marcello": 10000000,
  "rigme": "RIG"
};


/* ---------------- Boxes & unique item pools ----------------
Each pool contains 10-15 text-only items with values, rarity, weight.
Weights approximate odds: many commons, fewer uncommons, rare epics/legendaries.
*/
const BOXES = [
  {
    name: "Penny Trinkets", price: 0.14,
    items: [
      {name:"Used Sticker", value:0.02, rarity:"common", weight:50},
      {name:"Paper Pin", value:0.03, rarity:"common", weight:30},
      {name:"Plastic Badge", value:0.05, rarity:"common", weight:20},
      {name:"Keytag", value:0.08, rarity:"uncommon", weight:12},
      {name:"Lapel Clip", value:0.12, rarity:"uncommon", weight:8},
      {name:"Lucky Coin", value:0.20, rarity:"uncommon", weight:6},
      {name:"Mini Charms Set", value:0.35, rarity:"epic", weight:2},
      {name:"Tiny Figurine", value:0.70, rarity:"legendary", weight:1}
    ]
  },
  {
    name: "Tiny Box", price: 0.19,
    items: [
      {name:"Sticker Pack", value:0.05, rarity:"common", weight:48},
      {name:"Button Pin", value:0.08, rarity:"common", weight:32},
      {name:"Lanyard", value:0.16, rarity:"common", weight:20},
      {name:"Keychain", value:0.19, rarity:"uncommon", weight:12},
      {name:"Cap Clip", value:0.27, rarity:"uncommon", weight:8},
      {name:"Enamel Pin", value:0.55, rarity:"epic", weight:2},
      {name:"Micro Figurine", value:1.10, rarity:"legendary", weight:1},
    ]
  },
  {
    name: "Mini Box", price: 0.36,
    items: [
      {name:"Paper Cards", value:0.12, rarity:"common", weight:50},
      {name:"Sticker Roll", value:0.18, rarity:"common", weight:30},
      {name:"Key Strap", value:0.34, rarity:"uncommon", weight:14},
      {name:"Coin Pouch", value:0.36, rarity:"uncommon", weight:8},
      {name:"Desk Toy", value:0.95, rarity:"epic", weight:3},
      {name:"Pocket Knife (toy)", value:1.70, rarity:"legendary", weight:1}
    ]
  },
  {
    name: "Small Box", price: 0.73,
    items: [
      {name:"Cloth Patch", value:0.25, rarity:"common", weight:50},
      {name:"Rubber Bracelet", value:0.41, rarity:"common", weight:30},
      {name:"Mini Poster", value:0.70, rarity:"uncommon", weight:12},
      {name:"Cap Clip", value:0.73, rarity:"uncommon", weight:6},
      {name:"Pocket Earbuds", value:1.45, rarity:"epic", weight:1},
      {name:"LED Keylight", value:2.60, rarity:"legendary", weight:1}
    ]
  },
  {
    name: "Bronze Box", price: 0.36,
    items: [
      {name:"Bronze Pendant", value:0.30, rarity:"common", weight:50},
      {name:"Basic Mug", value:0.45, rarity:"common", weight:30},
      {name:"Bottle Opener", value:0.70, rarity:"uncommon", weight:12},
      {name:"Travel Towel", value:0.80, rarity:"uncommon", weight:6},
      {name:"Wireless Charger (low)", value:1.90, rarity:"epic", weight:1},
      {name:"Compact Powerbank", value:3.25, rarity:"legendary", weight:1}
    ]
  },
  {
    name: "Starter Silver", price: 0.79,
    items: [
      {name:"Phone Grip", value:0.40, rarity:"common", weight:48},
      {name:"Mousepad Mini", value:0.75, rarity:"common", weight:30},
      {name:"Cap", value:0.79, rarity:"uncommon", weight:12},
      {name:"USB Drive 16GB", value:1.60, rarity:"uncommon", weight:7},
      {name:"Bluetooth Tag", value:3.20, rarity:"epic", weight:2},
      {name:"Compact Speaker", value:6.00, rarity:"legendary", weight:1}
    ]
  },
  {
    name: "Tech Box", price: 1.67,
    items: [
      {name:"Phone Stand", value:0.95, rarity:"common", weight:45},
      {name:"Cable Kit", value:1.10, rarity:"common", weight:30},
      {name:"Portable Lamp", value:1.50, rarity:"uncommon", weight:12},
      {name:"Wireless Mouse (basic)", value:1.67, rarity:"uncommon", weight:8},
      {name:"Earbuds (budget)", value:4.25, rarity:"epic", weight:3},
      {name:"Smartband (entry)", value:9.50, rarity:"legendary", weight:2}
    ]
  },
  {
    name: "Silver Box", price: 1.98,
    items: [
      {name:"Shirt (graphic)", value:0.85, rarity:"common", weight:45},
      {name:"Cap (embroidered)", value:1.10, rarity:"common", weight:30},
      {name:"Mouse (basic)", value:1.90, rarity:"uncommon", weight:12},
      {name:"Keyboard (basic)", value:1.98, rarity:"uncommon", weight:8},
      {name:"Headphones (mid)", value:4.10, rarity:"epic", weight:3},
      {name:"Mechanical Keyboard", value:10.50, rarity:"legendary", weight:2}
    ]
  },
  {
    name: "Gamer Box", price: 4.62,
    items: [
      {name:"Controller Grip", value:1.80, rarity:"common", weight:45},
      {name:"RGB Strip", value:2.25, rarity:"common", weight:30},
      {name:"Gaming Mouse", value:4.40, rarity:"uncommon", weight:12},
      {name:"Mechanical KB (lite)", value:4.62, rarity:"uncommon", weight:8},
      {name:"Monitor 75Hz", value:9.50, rarity:"epic", weight:3},
      {name:"Gaming Chair", value:24.00, rarity:"legendary", weight:2}
    ]
  },
  {
    name: "Diamond Box", price: 7.27,
    items: [
      {name:"Desk Mic (basic)", value:3.10, rarity:"common", weight:45},
      {name:"Headset Stand", value:4.20, rarity:"common", weight:30},
      {name:"Gaming Headset", value:7.00, rarity:"uncommon", weight:12},
      {name:"Controller", value:7.27, rarity:"uncommon", weight:8},
      {name:"144Hz Monitor", value:18.90, rarity:"epic", weight:3},
      {name:"Stream Deck (mini)", value:42.00, rarity:"legendary", weight:2}
    ]
  },
  {
    name: "Pro Gear", price: 15.00,
    items: [
      {name:"Mic Arm", value:6.00, rarity:"common", weight:45},
      {name:"Webcam 1080p", value:8.50, rarity:"common", weight:30},
      {name:"Wireless Mouse (pro)", value:14.50, rarity:"uncommon", weight:12},
      {name:"Compact Keyboard", value:15.00, rarity:"uncommon", weight:8},
      {name:"27\" Monitor", value:32.00, rarity:"epic", weight:3},
      {name:"VR Headset (entry)", value:95.00, rarity:"legendary", weight:2}
    ]
  },
  {
    name: "Creator Kit", price: 25.00,
    items: [
      {name:"Softbox Light", value:10.00, rarity:"common", weight:40},
      {name:"USB Mic", value:14.00, rarity:"common", weight:30},
      {name:"Audio Interface", value:24.00, rarity:"uncommon", weight:12},
      {name:"Tripod", value:25.00, rarity:"uncommon", weight:8},
      {name:"Mirrorless Lens (basic)", value:60.00, rarity:"epic", weight:3},
      {name:"Action Camera", value:180.00, rarity:"legendary", weight:2}
    ]
  },
  {
    name: "Enthusiast Box", price: 49.99,
    items: [
      {name:"60% Keyboard", value:21.00, rarity:"common", weight:40},
      {name:"Wireless Headset", value:29.00, rarity:"common", weight:30},
      {name:"27\" 144Hz", value:48.00, rarity:"uncommon", weight:12},
      {name:"Stylus Tablet", value:49.99, rarity:"uncommon", weight:8},
      {name:"4K Monitor", value:120.00, rarity:"epic", weight:3},
      {name:"RTX Mid GPU", value:350.00, rarity:"legendary", weight:2}
    ]
  },
  {
    name: "Luxury Box", price: 19.80,
    items: [
      {name:"Premium Mug", value:9.99, rarity:"common", weight:40},
      {name:"Leather Journal", value:14.50, rarity:"common", weight:30},
      {name:"Portable SSD 256GB", value:19.80, rarity:"uncommon", weight:12},
      {name:"Bluetooth Headset", value:29.99, rarity:"uncommon", weight:8},
      {name:"High-end Earbuds", value:79.00, rarity:"epic", weight:3},
      {name:"Designer Watch", value:240.00, rarity:"legendary", weight:2}
    ]
  },
  {
    name: "Crypto Box", price: 73.00,
    items: [
      {name:"Hardware Key", value:12.00, rarity:"common", weight:35},
      {name:"Ledger Case", value:28.00, rarity:"common", weight:30},
      {name:"Mining Stick (toy)", value:45.00, rarity:"uncommon", weight:15},
      {name:"Cold Wallet", value:73.00, rarity:"uncommon", weight:12},
      {name:"Small BTC Voucher", value:200.00, rarity:"epic", weight:6},
      {name:"Rare NFT Print", value:650.00, rarity:"legendary", weight:2}
    ]
  },
  {
    name: "Ultra Rich", price: 500.00,
    items: [
      {name:"High-End DAC", value:260.00, rarity:"common", weight:40},
      {name:"PS5 / XSX", value:600.00, rarity:"common", weight:30},
      {name:"Pro Monitor", value:480.00, rarity:"uncommon", weight:12},
      {name:"High-tier Chair", value:520.00, rarity:"uncommon", weight:10},
      {name:"Premium Laptop", value:1800.00, rarity:"epic", weight:5},
      {name:"Top GPU", value:4500.00, rarity:"legendary", weight:3}
    ]
  },
  {
    name: "Elite Box", price: 1234.56,
    items: [
      {name:"Pro Camera", value:900.00, rarity:"common", weight:40},
      {name:"Studio Monitor", value:1200.00, rarity:"common", weight:30},
      {name:"Workstation SSD", value:1150.00, rarity:"uncommon", weight:12},
      {name:"High-end GPU", value:1999.00, rarity:"uncommon", weight:10},
      {name:"Creator Laptop", value:4500.00, rarity:"epic", weight:5},
      {name:"Cinema Camera", value:12000.00, rarity:"legendary", weight:3}
    ]
  },
  {
    name: "Godly Box", price: 9670.78,
    items: [
      {name:"OLED Wall", value:4000.00, rarity:"common", weight:40},
      {name:"Studio Rack", value:5200.00, rarity:"common", weight:30},
      {name:"Dual-GPU Beast", value:9500.00, rarity:"uncommon", weight:12},
      {name:"8K Camera", value:9670.78, rarity:"uncommon", weight:10},
      {name:"Mocap Stage", value:22000.00, rarity:"epic", weight:5},
      {name:"Full Studio Build", value:60000.00, rarity:"legendary", weight:3}
    ]
  },
  {
    name: "Ducky box", price: 13486.64,
    items: [
      {name:"Donald ducky", value:4000.00, rarity:"common", weight:40},
      {name:"Big ducky", value:5200.00, rarity:"common", weight:30},
      {name:"Mini ducky", value:9500.00, rarity:"uncommon", weight:9},
      {name:"Cute ducky", value:9670.78, rarity:"uncommon", weight:8},
      {name:"Top hat ducky", value:22000.00, rarity:"epic", weight:6},
      {name:"Golden ducky", value:60000.00, rarity:"legendary", weight:3},
      {name:"Diamond ducky", value:100000.00, rarity:"diamond", weight:2},
      {name:"Ducky chan", value:110000.00, rarity:"diamond", weight:0.5},
      {name:"Duck bond", value:110000.00, rarity:"diamond", weight:0.4},
      {name:"Rainbow Ducky", value:1110000.00, rarity:"rainbow", weight:0.1}
    ]
  },
  {
    name: "Mine box", price: 100000.64,
    items: [
      {name:"Coal", value:13000.00, rarity:"common", weight:40},
      {name:"Copper", value:15000.00, rarity:"common", weight:30},
      {name:"Iron", value:18000.00, rarity:"uncommon", weight:9},
      {name:"Gold nugget", value:30000.78, rarity:"uncommon", weight:8},
      {name:"Quartz", value:40000.00, rarity:"epic", weight:6},
      {name:"Gold ore", value:60000.00, rarity:"legendary", weight:3},
      {name:"Diamond", value:6000000.00, rarity:"diamond", weight:2},
      {name:"Netherite scrap", value:7000000.00, rarity:"diamond", weight:0.5},
      {name:"Diamond block", value:9000000.00, rarity:"diamond", weight:0.49},
      {name:"Netherite block", value:11000000.00, rarity:"rainbow", weight:0.01}
    ]
  },
  {
    name: "Italian box", price: 1000000.64,
    items: [
      {name:"Bomba", value:13000.00, rarity:"common", weight:46},
      {name:"Battel shipa", value:15000.00, rarity:"common", weight:30},
      {name:"Tanka", value:18000.00, rarity:"uncommon", weight:9},
      {name:"Middleman", value:30000.78, rarity:"uncommon", weight:8},
      {name:"Telefone", value:60000.00, rarity:"legendary", weight:3},
      {name:"Piiistole", value:6000000.00, rarity:"diamond", weight:2},
      {name:"Sun", value:7000000.00, rarity:"diamond", weight:0.5},
      {name:"Alberto", value:9000000.00, rarity:"diamond", weight:0.49},
      {name:"Marcello", value:11000000.00, rarity:"rainbow", weight:0.01}
    ]
  },
  {
    name: "Eourope box", price: 1000000000000000000000000000000000000000000000000.64,
    items: [
      {name:"Denmark", value:13000000000000000000000000.00, rarity:"common", weight:46},
      {name:"France", value:15000000000000000000000000.00, rarity:"common", weight:30},
      {name:"Albanien", value:18000000000000000000000000.00, rarity:"uncommon", weight:9},
      {name:"Bosnien", value:30000000000000000000000000.78, rarity:"uncommon", weight:8},
      {name:"Croatia", value:60000000000000000000000000.00, rarity:"legendary", weight:3},
      {name:"Montenegro", value:600000000000000000000000000.00, rarity:"diamond", weight:2},
      {name:"Belarus", value:700000000000000000000000000.00, rarity:"diamond", weight:0.5},
      {name:"Sweden", value:900000000000000000000000000.00, rarity:"diamond", weight:0.499},
      {name:"Russian", value:11000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000.00, rarity:"rainbow", weight:0.001}
    ]
  }
];
/* ---------------- DOM refs ---------------- */
const balanceEl = document.getElementById('balance');
const boxesGrid = document.getElementById('boxesGrid');
const casePopup = document.getElementById('casePopup');
const caseStrip = document.getElementById('caseStrip');
const centerPointer = document.getElementById('centerPointer');
const winPopup = document.getElementById('winPopup');
const winTitle = document.getElementById('winTitle');
const winMeta = document.getElementById('winMeta');
const keepBtn = document.getElementById('keepBtn');
const sellBtn = document.getElementById('sellBtn');
const invGrid = document.getElementById('invGrid');
const redeemInputEl = document.getElementById('redeemInput');
const redeemBtnEl = document.getElementById('redeemBtn');
const redeemMsgEl = document.getElementById('redeemMsg');
const addDollarBtn = document.getElementById('addDollar');
const btnHome = document.getElementById('btnHome');
const btnInv = document.getElementById('btnInv');
const btnRedeem = document.getElementById('btnRedeem');

/* --------------- helpers -------------- */
function normCode(s){ return (s||'').trim().toLowerCase().replace(/\s+/g,''); }
function updateBalance(){ balanceEl.textContent = balance.toFixed(2); }

/* --------------- render boxes -------------- */
function renderBoxes(){
  boxesGrid.innerHTML = '';
  BOXES.forEach((b, i)=>{
    const card = document.createElement('div');
    card.className = 'boxCard';
    card.innerHTML = `
      <div style="width:100%;display:flex;flex-direction:column;align-items:center;">
        <h3 style="margin:0">${b.name}</h3>
        <div class="boxPrice" style="margin-top:6px">Price: $${b.price.toFixed(2)}</div>
        <div style="opacity:.85;font-size:.9rem;margin-top:6px">${b.items.length} items</div>
      </div>
      <div style="width:100%;display:flex;justify-content:center;">
        <button class="btn openBtn">Open</button>
      </div>
    `;
    card.querySelector('.openBtn').addEventListener('click', ()=> openBox(i));
    boxesGrid.appendChild(card);
  });
}
renderBoxes();

/* ------------- pick weighted -------------- */
function pickWeighted(pool){
  const total = pool.reduce((s,it)=>s+it.weight,0);
  let r = Math.random() * total;
  for(const it of pool){
    if(r < it.weight) return it;
    r -= it.weight;
  }
  return pool[pool.length-1];
}

/* ------------- open box (preselect winner & animate) -------------- */
function openBox(boxIndex) {
  const BOX = BOXES[boxIndex];
  if (balance < BOX.price) { 
    alert('Not enough balance!'); 
    return; 
  }
  balance -= BOX.price; 
  updateBalance();

  // --- Preselect winner (rig if needed) ---
  // --- Preselect winner (rig if needed) ---
let winnerItem;
if (riggedDropsLeft > 0) {
  winnerItem = BOX.items.reduce((best, it) => it.value > best.value ? it : best, BOX.items[0]);
  riggedDropsLeft--;
} else {
  winnerItem = pickWeighted(BOX.items);
}

// --- Build strip ---
caseStrip.innerHTML = '';
const leftPad = 8;
const repeats = 24;
const rightPad = 8;
const strip = [];

// fill with junk first
for (let i = 0; i < leftPad; i++) strip.push(pickWeighted(BOX.items));
for (let r = 0; r < repeats; r++) BOX.items.forEach(it => strip.push(it));
for (let i = 0; i < rightPad; i++) strip.push(pickWeighted(BOX.items));

// force winner into the exact center slot
// force winner somewhere in the middle of the strip
const winnerIndex = leftPad + Math.floor((repeats * BOX.items.length) / 2);
strip[winnerIndex] = winnerItem;

// render strip (same as before)
strip.forEach(it => {
  const el = document.createElement('div');
  el.className = 'case-item ' + (it.name.length > 18 ? 'small' : '');
  el.classList.add('r-' + it.rarity);
  el.innerHTML = `<div class="iname">${it.name}</div><div class="ival">$${it.value.toFixed(2)}</div>`;
  caseStrip.appendChild(el);
});

// reset transform and show popup
caseStrip.style.transition = 'none';
caseStrip.style.transform = 'translateX(0px)';
void caseStrip.offsetWidth;
casePopup.style.display = 'flex';
casePopup.setAttribute('aria-hidden','false');

// compute item width
// compute item width
const firstChild = caseStrip.children[0];
const itemWidth = Math.round(firstChild.getBoundingClientRect().width + 16); // include margins
const containerWidth = caseStrip.parentElement.getBoundingClientRect().width;
const centerOffset = (containerWidth / 2) - (itemWidth / 2);

// ‚úÖ Align winner exactly under pointer
const translateX = -(winnerIndex * itemWidth - centerOffset);

// compute duration
const pixelsToTravel = Math.abs(translateX);
const speed = 900; // px/sec
let duration = pixelsToTravel / speed;
duration = Math.min(Math.max(duration, 3.6), 7.5);

// animate
caseStrip.style.transition = `transform ${duration}s cubic-bezier(.16,.84,.14,1)`;
requestAnimationFrame(() => {
  caseStrip.style.transform = `translateX(${translateX}px)`;
});


// show result after animation
setTimeout(() => {
  currentDrop = {
    box: BOX.name,
    name: winnerItem.name,
    rarity: winnerItem.rarity,
    value: winnerItem.value
  };
  winTitle.textContent = `You got: ${currentDrop.name}`;
  winMeta.textContent = `${currentDrop.box} ‚Ä¢ ${currentDrop.rarity.toUpperCase()} ‚Ä¢ $${currentDrop.value.toFixed(2)}`;
  winPopup.style.display = 'flex';
  casePopup.style.display = 'none';
  casePopup.setAttribute('aria-hidden', 'true');
}, Math.round(duration * 1000 + 80));

}

/* ------------- keep / sell (popup) -------------- */
document.getElementById('keepBtn').addEventListener('click', ()=>{
  if(!currentDrop) return;
  inventory.push({...currentDrop, id:Date.now()+Math.random()});
  currentDrop = null;
  winPopup.style.display = 'none';
  showInventory('all');
});
document.getElementById('sellBtn').addEventListener('click', ()=>{
  if(!currentDrop) return;
  balance += currentDrop.value;
  updateBalance();
  currentDrop = null;
  winPopup.style.display = 'none';
});

/* ------------- inventory render & sell from inv -------------- */
function renderInventory(filter='all'){
  invGrid.innerHTML = '';
  const list = (filter === 'all') ? inventory : inventory.filter(i=>i.rarity === filter);
  if(list.length === 0){
    const empty = document.createElement('div');
    empty.className = 'invCard';
    empty.style.gridColumn = '1/-1';
    empty.style.textAlign = 'center';
    empty.textContent = 'No items yet';
    invGrid.appendChild(empty);
    return;
  }
  list.forEach((it, idx) => {
    const card = document.createElement('div');
    card.className = 'invCard';
    card.innerHTML = `
      <div style="font-weight:700">${it.name}</div>
      <div class="invMeta"><div style="opacity:.9">${it.box}</div><div style="font-weight:700">$${it.value.toFixed(2)}</div></div>
      <div style="margin-top:8px;display:flex;gap:8px;justify-content:flex-end">
        <button class="btn keepInvBtn">Keep</button>
        <button class="btn sellInvBtn">Sell</button>
      </div>
    `;
    // keep does nothing (already kept) but we keep button for UX
    card.querySelector('.keepInvBtn').addEventListener('click', ()=>{ alert('Item is already in your inventory.'); });
    card.querySelector('.sellInvBtn').addEventListener('click', ()=>{
      // find index in original inventory and remove that item
      const originalIndex = inventory.indexOf(it);
      if(originalIndex !== -1){
        balance += it.value;
        updateBalance();
        inventory.splice(originalIndex,1);
        renderInventory(filter);
      }
    });
    invGrid.appendChild(card);
  });
}

/* filter buttons */
document.querySelectorAll('.filterBtn').forEach(btn=>{
  btn.addEventListener('click', ()=>{
    const f = btn.dataset.filter;
    renderInventory(f === 'all' ? 'all' : f);
  });
});

/* ------------- redeem & add money -------------- */
redeemBtnEl.addEventListener('click', () => {
  const raw = redeemInputEl.value || '';
  const code = normCode(raw);
  if (!code) {
    redeemMsgEl.textContent = 'Enter a code.';
    return;
  }

  // üîπ Handle rigme codes first
  if (/^rigme\d*$/i.test(code)) {
    const match = code.match(/rigme(\d+)/i);
    if (match) {
      riggedDropsLeft += parseInt(match[1], 10); // rigmeN adds N
    } else {
      riggedDropsLeft += 1; // plain rigme adds 1
    }
    redeemMsgEl.textContent = `‚ú® Your next ${riggedDropsLeft} case(s) are rigged to MAX! ‚ú®`;
    return;
  }

  // üîπ Otherwise handle normal codes from redeemCodes
  if (redeemCodes.hasOwnProperty(code)) {
    const amt = redeemCodes[code];
    balance += amt;
    updateBalance();
    redeemMsgEl.textContent = `‚úÖ Redeemed $${amt.toFixed(2)}!`;
  } else {
    redeemMsgEl.textContent = '‚ùå Invalid or already used code.';
  }
});


addDollarBtn.addEventListener('click', ()=>{ balance += 1; updateBalance(); });

/* ------------- tabs -------------- */
function hideTabs(){ document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active')); }
function showHome(){ hideTabs(); document.getElementById('homeTab').classList.add('active'); }
function showInventory(filter='all'){ hideTabs(); document.getElementById('invTab').classList.add('active'); renderInventory(filter); }
function showRedeem(){ hideTabs(); document.getElementById('redeemTab').classList.add('active'); }
btnHome.addEventListener('click', showHome);
btnInv.addEventListener('click', ()=>{ showInventory('all'); casePopup.style.display='none'; });
btnRedeem.addEventListener('click', showRedeem);

/* ------------- init -------------- */
updateBalance();
renderBoxes();

/* ensure pointer above everything */
document.getElementById('centerPointer').style.zIndex = 5000;
 // Function to spawn a custom item directly into inventory
// Function to spawn a custom item directly into inventory
function spawnInThing(name, value, rarity = "common", amount = 1) {
  for (let i = 0; i < amount; i++) {
    const newDrop = {
      box: "Custom Spawn", // or make this an argument too
      name: name,
      rarity: rarity.toLowerCase(),
      value: parseFloat(value),
      id: Date.now() + Math.random() // unique ID
    };
    inventory.push(newDrop);
  }

  renderInventory('all'); // refresh inventory UI
  alert(`‚ú® Spawned ${amount}x ${name} [${rarity}] worth $${value} each!`);
}

</script>
</body>
</html>
